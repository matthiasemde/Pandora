events {
    worker_connections 1024;
}

http {
    include /etc/nginx/mime.types;
    default_type application/octet-stream;

    # Respect X-Forwarded-Proto from Traefik
    map $http_x_forwarded_proto $real_scheme {
        default $scheme;
        https https;
    }

    server {
        listen 80;
        server_name _;
        
        # Use the forwarded protocol for redirects
        absolute_redirect off;
        port_in_redirect off;
        
        root /usr/share/nginx/html/projects;
        
        # Serve custom landing page at root
        location = / {
            alias /usr/share/nginx/html/;
            try_files /index.html =404;
        }
        
        # API endpoint for project listing (directory listing)
        location /api/projects {
            alias /usr/share/nginx/html/projects;
            autoindex on;
            autoindex_format html;
        }
        
        # Serve individual projects with autoindex for subdirectories
        location / {
            autoindex on;
            autoindex_format html;
            autoindex_exact_size off;
            autoindex_localtime on;
            try_files $uri $uri/ $uri/index.html =404;
        }
        
        # Enable gzip compression
        gzip on;
        gzip_types text/plain text/css application/json application/javascript text/xml application/xml application/xml+rss text/javascript image/svg+xml;
    }
}
